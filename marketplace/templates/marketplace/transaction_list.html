{% extends "base.html" %}

{% block head %} 
    {% load static %} 
{% endblock head %} 

{% block content %}
    {% for item in object_list %}
        <div>
            {% if item.listing.user == request.user %}
                {% if item.listing.sold == False and item.accepted == None %}
                    <a href={% url "marketplace:transaction_update" transaction_id=item.id %}> {{item.created_at}} Proposta da {{item.buyer.username}} - offerta {{item.proposed_price}} </a>
                {% else %}
                    <a href={% url "marketplace:transaction_detail" transaction_id=item.id%}> {{item.created_at}} Proposta da {{item.buyer.username}} - offerta {{item.proposed_price}} - stato:
                        {% if item.accepted == True %}
                            accettato </a>
                            {% for feedback in item.feedbacks.all %}
                                {% if feedback.user_src == request.user %}
                                    {% if feedback.rating == None %}
                                        <a href={% url "marketplace:feedback_send" transaction_id=item.id %}> Hai un feedback da lasciare </a>
                                    {% else %}
                                        <a href={% url "marketplace:feedback_detail" feedback_id=feedback.id %}> Visualizza il feedback lasciato </a>
                                    {% endif %}
                                {% elif feedback.user_dst == request.user %}
                                    {% if feedback.rating == None %}
                                        <a> Non hai ancora ricevuto un feedback </a>
                                    {% else %}
                                        <a href={% url "marketplace:feedback_detail" feedback_id=feedback.id %}> Visualizza il feedback ricevuto </a>
                                    {% endif %}
                                {% endif %}
                            {% endfor %}
                        {% else %}
                            rifiutato </a>
                        {% endif %} 
                {% endif %}
            {% elif item.buyer == request.user %}
                <a href={% url "marketplace:transaction_detail" transaction_id=item.id%}> {{item.created_at}} Proposta a {{item.listing.user.username}} - offerta {{item.proposed_price}} - stato: 
                    {% if item.accepted == None %}
                        pending </a>
                    {% elif item.accepted == True %}
                        accettato </a>
                        {% for feedback in item.feedbacks.all %}
                            {% if feedback.user_src == request.user %}
                                {% if feedback.rating == None %}
                                    <a href={% url "marketplace:feedback_send" transaction_id=item.id %}> Hai un feedback da lasciare </a>
                                {% else %}
                                    <a href={% url "marketplace:feedback_detail" feedback_id=feedback.id %}> Visualizza il feedback lasciato </a>
                                {% endif %}
                            {% elif feedback.user_dst == request.user %}
                                {% if feedback.rating == None %}
                                    <a> Non hai ancora ricevuto un feedback </a>
                                {% else %}
                                    <a href={% url "marketplace:feedback_detail" feedback_id=feedback.id %}> Visualizza il feedback ricevuto </a>
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                    {% else %}
                        rifiutato </a>
                    {% endif %}
            {% endif %}    
        </div>
    {% endfor %}
{% endblock %}